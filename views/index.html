{{ block "index" . }}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PomoChan</title>
    <script src="/js/htmx.js"></script>
    <script src="/js/htmx-sse-ext.js"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div id="main">
        <h1>PomoChan</h1>
        <p class="demoDescription">For demonstration 1 second = 1 minute</p>
        <nav><a class="changePage" href="/">Timer</a><a class="changePage" href="/stats">Stats</a></nav>
        <div class="dynamicThing" hx-ext="sse" sse-connect="/events">
            <div id="activities" sse-swap="SyncActivities">
                {{ template "activities" . }}
            </div>
            <div id="mode" sse-swap="SyncMode">
                {{ template "mode" .}}
            </div>
            <div id="timer" sse-swap="SyncTimer" hx-swap="innerHTML">
                {{ template "timer" . }}
            </div>
            <div id="controls" sse-swap="PomoStarted,PomoPaused,PomoResumed,PomoReset,PomoSaved,SyncControls" hx-swap="innerHTML">
                {{ template "controls" . }}
            </div>
            <div id="tracked" sse-swap="SyncTracked" hx-swap="innerHTML">
                {{ template "tracked" . }}
            </div>
        </div>
    </div>

    <!-- <hr> -->
    <!-- <div id="clients" hx-get="/clients" hx-trigger="every 3s" hx-swap="innerHTML"></div> -->
    <!-- <div id="debug" hx-get="/debug" hx-trigger="every 1s" hx-swap="innerHTML">
        {{ template "debug" . }}
    </div> -->
    <!-- <script defer>
        document.body.addEventListener('htmx:sseOpen', function (e) {
            // do something before the event data is swapped in
            console.log('htmx:sseOpen', e);
        })
        document.body.addEventListener('htmx:sseError', function (e) {
            // do something before the event data is swapped in
            console.log('htmx:sseError', e);
        })
        document.body.addEventListener('htmx:sseBeforeMessage', function (e) {
            // do something before the event data is swapped in
            console.log('htmx:sseBeforeMessage', e);
        })
        document.body.addEventListener('htmx:sseClose', function (e) {
            // do something before the event data is swapped in
            console.log('htmx:sseMessage', e);
        })
        document.body.addEventListener('htmx:sseClose', function (e) {
            // do something before the event data is swapped in
            console.log('htmx:sseOpen', e);
        })
    </script> -->
</body>

</html>
{{ end }}

{{ block "mode" .}}
{{/* ids for css transition to work */}}
    <button id="modeFlow" class="modeBtn flowBtn {{ if .FlowMode }}active{{end}}" hx-post="/toggle-flow">Flow</button>
    <button id="modeAutoBreaks" class="modeBtn autoBreakBtn {{ if .AutoBreak }}active{{end}}" hx-post="/toggle-auto-break">Auto Break</button>
    <button id="modeDur25" class="modeBtn durationBtn {{ if eq .PreferredDurationMinutes 25 }}active{{ end }}" {{ if .FlowMode }}disabled{{end}} name="duration" hx-post="/set-duration" value="25">25</button>
    <button id="modeDur50" class="modeBtn durationBtn {{ if eq .PreferredDurationMinutes 50 }}active{{ end }}" {{ if .FlowMode }}disabled{{end}} name="duration" hx-post="/set-duration" value="50">50</button>
    <button id="modeDur75" class="modeBtn durationBtn {{ if eq .PreferredDurationMinutes 75 }}active{{ end }}" {{ if .FlowMode }}disabled{{end}} name="duration" hx-post="/set-duration" value="75">75</button>
{{ end }}

{{ block "activities" . }}
<label for="activity">Activity:</label>
<select id="activity" name="activity" hx-post="/activity" hx-swap="none">
    {{ range .Activities }}
        <option value="{{ .Id }}" {{ if eq $.CurrentActivity.Id .Id }}selected{{ end }}>{{ .Name }}</option>
    {{ end }}
</select>
{{ end }}

{{ block "timer" . }}
    {{ if .CurrentPomo}}
        {{ if .CurrentPomo.IsBreak}}
        <div>Break time üéâ</div>
        {{ else }}
        <div>Focus time üçÖ</div>
        {{ end }}
        {{ .CurrentPomo.PrintTime }}: {{ .CurrentPomo.Activity.Name}}
    {{ else }}
        <div>Start new pomodoro</div>
        {{ .PrintPreferredDuration }}
    {{ end }}
{{ end }}

{{ block "controls" . }}
    {{ if .Running }}
        {{ if not .CurrentPomo.IsBreak}}
            <button hx-post="/start-pause" hx-swap="none">Pause</button>
            {{else}}
            <button hx-post="/reset" hx-swap="none">Skip</button>
        {{ end }}
    {{ else if .CurrentPomo }}
        <button hx-post="/start-pause" hx-swap="none">Resume</button>
    {{ else }}
        <button hx-post="/start-pause" hx-swap="none">Start</button>
    {{ end }}

    {{ if and .CurrentPomo (not .CurrentPomo.IsBreak) }}
        <button hx-post="/reset" hx-swap="none">Reset</button>
    {{ end }}
    {{ if and .CurrentPomo (not .CurrentPomo.IsBreak) }}
        <button hx-post="/save" hx-swap="none" title="Save">üíæ</button>
    {{ end }}
    
    {{ if or (and .CurrentPomo .CurrentPomo.Completed) (and .CurrentPomo .CurrentPomo.FlowMode)}}
        <div>
            <button hx-post="/start-break" hx-swap="none" title="Start Break">Stark Break</button>
        </div>
    {{ end }}
{{ end }}

{{ block "tracked" . }}
{{if .Tracked}}
    <h4>Tracked today:</h4>
    <p>Daily goal: {{ .DailyGoal }}üçÖ</p>
    <p>Total üçÖ: {{ .PrintTotalPomos }}/{{ .DailyGoal }}</p>
    <p>Total in time: {{ .PrintTotalTime }}</p>
    <ul style="display: flex; flex-direction:column-reverse;">
        {{range .Tracked }}
        <li>
            Time: {{.TimePassed}}
            <br>
            Activity: {{ .Activity.Name }}
        </li>
        {{end}}
    </ul>
{{else}}
<h4>No pomodoros tracked today</h4>
{{end}}
{{ end }}

{{ block "debug" . }}
{{ printf "%#v" . }}

<br>
CurrentPomo: {{ printf "%#v" .CurrentPomo}}
<br>
Connected clients: {{ len .Clients}}
{{ end }}